@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.play.views.html.helpers.form
@import models.AccountingDatesModel.{WHEN_REGISTERED, FUTURE_DATE, NOT_PLANNING_TO_YET}
@import controllers.CRLanguageController
@import play.api.Application

@(companyName : String,
  jurisdiction : String,
  accDate : AccountingDatesModel,
  ppob : PPOBModel,
  roAddress : CHROAddress,
  ctContactDets : CompanyContactDetailsApi,
  tradingDetails : TradingDetails,
  applicant : AboutYouChoice)(implicit request: Request[_], lang: Lang, messages: Messages, appConfig: config.FrontendAppConfig)

@ppobMessage = {
    @Messages("page.reg.summary.PPOBSameAsRO")
}

@formatAddress(addressElement: String) = {
    @if(addressElement != "") {
        @addressElement<br>
    }
}

@readableTrading(tradingDetails : TradingDetails) = {
    @if(tradingDetails.regularPayments.toBoolean) {
        @Html("Yes")
    } else {
        @Html("No")
    }
}

@main_template(title = Messages("page.reg.summary.description")){

  <a id="back" class="link-back" href="@controllers.reg.routes.SummaryController.back()">@Messages("common.button.back")</a>

  <h1 id="main-heading" class="heading-large">@Messages("page.reg.summary.description")</h1>
  <h2 class="heading-24">@Messages("page.reg.summary.page")</h2>

  <h2 id="applicantTitle" class="heading-medium">@Messages("page.reg.summary.heading.applicant")</h2>
  <dl class="govuk-check-your-answers cya-questions-long">
    <div>
      <dt class="cya-question">@Messages("page.reg.summary.applicantText")</dt>
      <dd id="applicant" class="cya-answer">@applicant.completionCapacity.capitalize</dd>
      <dd class="cya-change"><a href="@controllers.reg.routes.CompletionCapacityController.show" id="change-applicant">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.applicant.change")</span></a></dd>
    </div>
  </dl>

  <h2 id="companyNameTitle" class="heading-medium">@Messages("page.reg.summary.heading.one")</h2>
  <dl class="govuk-check-your-answers cya-questions-long">
    <div>
      <dt class="cya-question">@Messages("page.reg.summary.companyNameText")</dt>
      <dd id="companyName" class="cya-answer">@companyName</dd>
      <dd class="cya-change"><a href='@controllers.reg.routes.SummaryController.summaryBackLink("company_name")' id="change-companyname">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.companyName.change")</span></a></dd>
    </div>

    <div>
      <dt class="cya-question">@Messages("page.reg.summary.ROAddressText")</dt>
      <dd id="ROAddress" class="cya-answer">

          @if(s"${roAddress.premises} ${roAddress.address_line_1}".length <= 27) {
          @formatAddress(s"${roAddress.premises} ${roAddress.address_line_1}")
          } else {
          @formatAddress(roAddress.premises)
          @formatAddress(roAddress.address_line_1)
          }

        @formatAddress(roAddress.address_line_2.fold[String]("")(s => s ))
        @formatAddress(roAddress.locality)
        @formatAddress(roAddress.region.fold[String]("")(s => s ))
        @formatAddress(roAddress.postal_code.fold[String]("")(s => s ))
        @formatAddress(roAddress.country)
      </dd>
      <dd class="cya-change"><a href='@controllers.reg.routes.SummaryController.summaryBackLink("company_address")' id="change-roaddress">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.ROAddress.change")</span></a></dd>
    </div>

    <div>
      <dt class="cya-question">@Messages("page.reg.summary.jurisdictionText")</dt>
      <dd id="jurisdiction" class="cya-answer">@jurisdiction</dd>
      <dd class="cya-change"><a href='@controllers.reg.routes.SummaryController.summaryBackLink("company_jurisdiction")' id="change-jurisdiction">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.jurisdiction.change")</span></a></dd>
    </div>

    <div>
      <dt class="cya-question">@Messages("page.reg.summary.PPOBAddressText")</dt>
      <dd id="PPOBAddress" class="cya-answer">
        @{
        if(ppob.ppob.addressType == "RO"){
        ppobMessage
        } else {
        Html(
        ppob.ppob.address.get.addressLine1 + "<br>" +
        ppob.ppob.address.get.addressLine2 + "<br>" +
        ppob.ppob.address.get.addressLine3.fold[String]("")(s => s + "<br>") +
        ppob.ppob.address.get.addressLine4.fold[String]("")(s => s + "<br>") +
        ppob.ppob.address.get.postCode.fold[String]("")(s => s + "<br>") +
        ppob.ppob.address.get.country.fold[String]("")(s => s ) )
          }
        }
      </dd>
      <dd class="cya-change"><a href="@controllers.reg.routes.PPOBController.show" id="change-ppob">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.PPOBAddress.change")</span></a></dd>
    </div>
  </dl>

  <h2 id="companyContactDetails" class="heading-medium">@Messages("page.reg.summary.heading.one.b")</h2>
  <dl class="govuk-check-your-answers cya-questions-long">
    <div id="contactBlock">
      <dt class="cya-question">@Messages("page.reg.summary.companyContact") @companyName</dt>
      <dd id="companyContact" class="cya-answer">@ctContactDets.contactDaytimeTelephoneNumber<br>@ctContactDets.contactEmail<br>@ctContactDets.contactMobileNumber<br></dd>
      <dd class="cya-change"><a href="@controllers.reg.routes.CompanyContactDetailsController.show" id="change-contact-details">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.companyContact.change")</span></a></dd>
    </div>
  </dl>

  <h2 id="companyAccountingTitle" class="heading-medium">@Messages("page.reg.summary.heading.two")</h2>
  <dl class="govuk-check-your-answers cya-questions-long">
    <div>
      <dt class="cya-question">@Messages("page.reg.summary.startDate")</dt>
      <dd id="startDate" class="cya-answer">
        @{if(accDate.crnDate == WHEN_REGISTERED){Messages("page.reg.summary.dateRegistered")}
        else if(accDate.crnDate == NOT_PLANNING_TO_YET){Messages("page.reg.summary.notPlanningToStartYet")}
        else {accDate.toSummaryDate}}
      </dd>
      <dd class="cya-change"><a href="@controllers.reg.routes.AccountingDatesController.show" id="change-accountingdates">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.startDate.change")</span></a></dd>
    </div>

    <div>
      <dt class="cya-question">@Messages("page.reg.summary.tradingDetails")</dt>
      <dd id="tradingDetails" class="cya-answer">@readableTrading(tradingDetails)</dd>
      <dd class="cya-change"><a href="@controllers.reg.routes.TradingDetailsController.show" id="change-trading-details">@Messages("change")<span class="visually-hidden">@Messages("page.reg.summary.tradingDetails.change")</span></a></dd>
    </div>
  </dl>
</br>
  <div class="form-group">
    <p>@Messages("page.reg.summary.pleaseReview")</p>
    <div class="panel panel-border-wide">
      <p>@messages("page.reg.summary.information.indent")</p>
    </div>
  </div>
  @form(action = controllers.reg.routes.SummaryController.submit()) {
  <div class="form-group">
    <input class="button" type="submit" id="next" value="@Messages("common.button.ConfirmAndContinue")">
  </div>
  }
}